# Cesium æºç è§£è¯»

### æ–‡ç« ç›®å½•

00æ–‡ç« ç›®å½•ä¸æºç ç®€å•è°ƒè¯•   [ğŸ‘‰ğŸ”—](https://github.com/githubli1123/CesiumExampleCollection/blob/main/Temp/%E9%9C%80%E8%A6%81%E5%8F%91%E5%B8%83%E7%9A%84%E5%8D%9A%E5%AE%A2/00%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%BA%90%E7%A0%81%E7%9A%84%E7%AE%80%E5%8D%95%E8%B0%83%E8%AF%95/00%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%B0%83%E8%AF%95.md)

01Cesiumçš„æ¸²æŸ“è°ƒåº¦  [ğŸ‘‰ğŸ”—](https://github.com/githubli1123/CesiumExampleCollection/blob/main/Temp/%E9%9C%80%E8%A6%81%E5%8F%91%E5%B8%83%E7%9A%84%E5%8D%9A%E5%AE%A2/01Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6/01Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6.md)



## 00æ–‡ç« ç›®å½•ä¸æºç çš„ç®€å•è°ƒè¯•

æœ¬ç¯‡æ–‡ç« æŒç»­æ›´æ–°ï¼Œæ„Ÿè§‰è°ƒè¯•æºç å’Œé˜…è¯»æºç çš„æ–¹æ³•ä¼šéšç€å·¥å…·çš„æ›´æ–°ä¸ AI çš„è¿­ä»£ä¸æ–­æ”¹å˜ä¼˜åŒ–ï¼Œè®©æˆ‘ä»¬æ›´å¥½çš„ç†è§£æºç ã€‚è€Œä¸”æœ¬äººæ¯”è¾ƒå–œæ¬¢é€šè¿‡å›¾åƒè¡¨æ ¼æ¥è®°å¿†å’Œç†è§£ï¼Œå›¾è¡¨å‡ºç°è¾ƒä¸ºé¢‘ç¹ã€‚æ–‡ç« é£æ ¼ä»‹ç»

æ‹¥æœ‰è¿™äº›é£æ ¼ï¼š

- å…³æ³¨ä¸»ä½“ã€‚åªçœ‹ä¸»è¦çš„æµç¨‹ï¼Œåªè€ƒè™‘è¿™ç§æƒ…å†µï¼šå³ç¬¬ä¸€æ¬¡ä½¿ç”¨ Cesium æ—¶åˆ›å»ºçš„ä¾‹å­ï¼Œå®ä¾‹ä»£ç é“¾æ¥åœ¨æ­¤ ğŸ‘‰ğŸ”—ã€‚
- é—ç•™é—®é¢˜ã€‚æœ‰äº›ä»£ç æˆ–è€…æµç¨‹æ— æ³•ç›´æ¥æ¢³ç†æ¸…æ¥šï¼Œä¼šç•™ä¸‹é—®é¢˜ï¼Œç­‰å¾…åé¢é˜…è¯»æºç çš„å…¶ä»–éƒ¨åˆ†åå†æ¥è§£ç­”ã€‚
- ä¸æ–­é‡å¤ã€‚æœ‰ä¸€äº›å›¾æˆ–è€…è¡¨è¿°ä¼šä¸æ–­é‡å¤ï¼Œä¸€ä¸ªæ˜¯éœ€è¦æœ‰è¿™äº›æ¥è®©æˆ‘çš„è¡¨è¿°æ›´åŠ æœ‰é€»è¾‘å’Œç›´è§‚ï¼Œè®©çŸ¥è¯†ç‚¹æœ‰éƒ¨åˆ†å…³è”ï¼ŒäºŒæ˜¯è®©è¯»è€…è®°å¿†æ·±åˆ»ã€‚
- ......

æ²¡æœ‰è¿™äº›é£æ ¼ï¼š

- æ³¨é‡å…³è”ã€‚çŸ¥è¯†ç‚¹æˆ–è€…ç±»å…³ç³»å°½é‡ä¸åšè¿‡å¤šå…³è”ï¼Œå¯èƒ½æ²¡æ³•è®©ä½ è§¦ç±»æ—é€šæˆ–è€…çŸ¥è¯†ç‚¹ä¹‹é—´çš„é“¾æ¥è¾ƒå¼±ã€‚
- è¡¨è¿°ä¸¥è°¨ã€‚æœ¬èº«æˆ‘ç›®å‰ä¹Ÿå¤„äºé˜…è¯»æºç çš„å‰æœŸé˜¶æ®µå§ï¼Œè¡¨è¿°æ¯”è¾ƒéšæ„ï¼Œæœ›è°…è§£ã€‚
- ......



### 1> å¦‚ä½•åšåˆ°å¯¹æºç è¿›è¡Œç®€å•è°ƒè¯•

âœ…è¿™é‡Œå°±ä¸å†èµ˜è¿°æºç å·¥ç¨‹ç›®å½•äº†ï¼ˆå¦‚æœéœ€è¦åé¢å†è¡¥å……ï¼‰ã€‚ç›´æ¥ç»™å¤§å®¶è¯´æ˜ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•åšåˆ°å¯¹ Cesium æºç è¿›è¡Œç®€å•çš„è°ƒè¯•ï¼š

1. å…‹éš†æºç ã€‚åœ¨ GitHub ä¸Šå…‹éš†ä¸€ä»½ Cesium æºç ï¼Œæˆ‘ç›®å‰ï¼ˆ2024å¹´4æœˆï¼‰ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ 1.116 ã€‚
2. æ‰§è¡Œ `npm i` å‘½ä»¤ã€‚æˆ‘ä»¬å…‹éš†çš„è¿™ä»½æºç å…¶å®å¹¶ä¸æ˜¯çº¯ç²¹çš„åªåŒ…å«æºç ä»£ç æ–‡ä»¶ï¼Œå…¶å®å®ƒä¹Ÿç®—æ˜¯ä¸€ä¸ªé¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªå·¥ç¨‹ï¼Œä½ å¯ä»¥æ‰§è¡Œ `npm i` å‘½ä»¤å ï¼ˆè¿™ä¸ªå‘½ä»¤ä¼šå¹²äº›ä»€ä¹ˆæï¼Œç›®å‰ä¸ç®¡ï¼‰æ‰“å¼€ index.html ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨çœ‹åˆ° Cesium ç¤ºä¾‹ã€æµ‹è¯•ä¸æ–‡æ¡£ã€‚
3. æ‰§è¡Œ `node server.js` å‘½ä»¤ã€‚ä½¿ç”¨ live server ç±»ä¼¼æ’ä»¶å¯åŠ¨æœåŠ¡æ‰“å¼€ index.html æ˜¯ä¸å¦¥çš„ã€‚éœ€è¦æ‰§è¡Œå‘½ä»¤è¡Œ `node server.js` å¯åŠ¨æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªåŸºäº Express çš„å¼€å‘æœåŠ¡å™¨ï¼Œç”¨äºåœ¨æœ¬åœ°å¼€å‘å’Œæµ‹è¯• CesiumJSï¼Œæä¾›äº†æ–‡ä»¶ç›‘å¬ã€è‡ªåŠ¨æ„å»ºã€é™æ€æ–‡ä»¶æœåŠ¡å’Œä»£ç†ç­‰åŠŸèƒ½ï¼Œæ–¹ä¾¿å¼€å‘è€…è¿›è¡Œ CesiumJS ç›¸å…³é¡¹ç›®çš„å¼€å‘å’Œè°ƒè¯•ã€‚
4. è°ƒè¯•æºç ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨å„ç±»è°ƒè¯•æ–¹æ³•æ¥è°ƒè¯• Cesium æºç äº†ï¼Œåœ¨ `packages` æ–‡ä»¶å¤¹ä¸‹ä¿®æ”¹æºç æ–‡ä»¶æˆ–è€…åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ–­ç‚¹è°ƒè¯•ã€‚

æš‚æ—¶ä¸åˆ†äº«è°ƒè¯•æºç çš„ä¸€äº›æŠ€å·§ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾ã€‚



ğŸ“Œå€¼å¾—æ³¨æ„çš„ä¸€äº›ç»†ç¢ç‚¹ï¼š

**1** åˆ†å‘åŒ…ä¸æºç åŒ…æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œåˆ†å‘åŒ…æä¾›äº†æ‰“åŒ…åçš„Buildæ–‡ä»¶å¤¹ï¼Œå¯ä¾›è°ƒè¯•æˆ–è€…å‘å¸ƒç›´æ¥ä½¿ç”¨ï¼›æä¾›äº†ä¸¤ä¸ªç‰ˆæœ¬çš„æ‰“åŒ…APIï¼Œæä¾›äº†APIæ–‡æ¡£ï¼Œåˆ é™¤äº†éƒ¨åˆ†ç”Ÿäº§ç”¨ä¸ç€çš„æ‰“åŒ…é…ç½®æ–‡ä»¶ã€‚æ³¨æ„ï¼Œåˆ†å‘åŒ…ä¿ç•™äº†æºç ç›®å½•ï¼Œä½†æ˜¯æœ‰å…³æ‰“åŒ…å‘½ä»¤å¯èƒ½å¤±æ•ˆã€‚è§å›¾

<img src="https://github.com/githubli1123/CesiumExampleCollection/blob/main/Img/00%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%BA%90%E7%A0%81%E7%9A%84%E7%AE%80%E5%8D%95%E8%B0%83%E8%AF%95/%E5%88%86%E5%8F%91%E5%8C%85%E4%B8%8E%E6%BA%90%E7%A0%81%E5%8C%85.png?raw=true" alt="åˆ†å‘åŒ…ä¸æºç åŒ…" style="zoom: 50%;" />



**2**  `Source` æºç èµ„æºæ–‡ä»¶å¤¹ä¸­çš„å˜æ›´ä¸ºäº† `package` æ–‡ä»¶å¤¹ã€‚è¿™ä¸€ç‚¹å¯ä»¥åœ¨ [Cesium1.100ç‰ˆæœ¬æ›´æ–°æ—¥å¿—](https://github.com/CesiumGS/cesium/releases/tag/1.100) ä¸­çœ‹åˆ°ï¼Œæºä»£ç å·²åˆ†åŒºä¸ºä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š `packages/engine` å’Œ `packages/widgets`ã€‚

<img src="https://github.com/githubli1123/CesiumExampleCollection/blob/main/Img/00%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%BA%90%E7%A0%81%E7%9A%84%E7%AE%80%E5%8D%95%E8%B0%83%E8%AF%95/Cesium1.100%E7%89%88%E6%9C%AC%E5%90%8E%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E7%9A%84%E6%94%B9%E5%8F%98.png?raw=true" alt="åˆ†å‘åŒ…ä¸æºç åŒ…" style="zoom: 50%;" />



ğŸ”—å‚è€ƒèµ„æ–™

[CesiumJS 2022^ æºç è§£è¯»0 - æ–‡ç« ç›®å½•ä¸æºç å·¥ç¨‹ç»“æ„ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/537147162)

[Cesiumæºç é˜…è¯»ç¯å¢ƒæ­å»º - å½“æ—¶æ˜æœˆåœ¨æ›¾ç…§å½©äº‘å½’ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/jiujiubashiyi/p/17111635.html)

[Cesiumæ‰“åŒ…å‘½ä»¤æ€»ç»“ - Cesiumå®éªŒå®¤ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/cesium1/p/10062900.html)

[Cesiumå¼€å‘å·¥å…·ç¯‡ 06Cesiumæºç ç¼–è¯‘æ‰“åŒ… - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/369519695)

[Cesiumæ‰“åŒ…å…¥é—¨(gulpä¸esbuild)_scripts.prepare cesium@1.95-CSDNåšå®¢](https://blog.csdn.net/u011575168/article/details/128419078)



### 2> æ–‡ç« ç›®å½•

00æ–‡ç« ç›®å½•ä¸æºç ç®€å•è°ƒè¯•   [ğŸ‘‰ğŸ”—](https://github.com/githubli1123/CesiumExampleCollection/blob/main/Temp/%E9%9C%80%E8%A6%81%E5%8F%91%E5%B8%83%E7%9A%84%E5%8D%9A%E5%AE%A2/00%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%BA%90%E7%A0%81%E7%9A%84%E7%AE%80%E5%8D%95%E8%B0%83%E8%AF%95/00%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%B0%83%E8%AF%95.md)

01Cesiumçš„æ¸²æŸ“è°ƒåº¦  [ğŸ‘‰ğŸ”—](https://github.com/githubli1123/CesiumExampleCollection/blob/main/Temp/%E9%9C%80%E8%A6%81%E5%8F%91%E5%B8%83%E7%9A%84%E5%8D%9A%E5%AE%A2/01Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6/01Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6.md)



---

## 01Cesiumçš„æ¸²æŸ“è°ƒåº¦

### 1> CesiumWidget ç±»æ˜¯æ¸²æŸ“è°ƒåº¦å™¨

æ‰€è°“çš„æ¸²æŸ“æ˜¯æŒ‡åœ¨æµè§ˆå™¨ canvas ä¸Šç»˜åˆ¶å›¾åƒï¼Œè°ƒåº¦æ˜¯æŒ‡æ§åˆ¶ç€è¿™ä¸ªæ¸²æŸ“çš„ä½¿ç”¨ã€‚å€ŸåŠ© `requestAnimationFrame, rAF` è¿™ä¸ªæµè§ˆå™¨ API æ¥ä¸æ–­åœ¨æ¯ä¸€å¸§è°ƒç”¨ å•å¸§æ¸²æŸ“å‡½æ•° `render()` ï¼Œå•å¸§æ¸²æŸ“å‡½æ•°å€ŸåŠ© WebGL æ¥å®ç° canvas ç»˜åˆ¶ã€‚è€Œè¿™ä¸ªå¤šå¸§å¾ªç¯å¾€å¤è¿è¡Œå’Œæ¸²æŸ“çš„è¿‡ç¨‹æœ‰ä¸€ä¸ªè°ƒåº¦è€…ï¼Œæ˜¯ `CesiumWidget` ç±»ã€‚

![](https://github.com/githubli1123/CesiumExampleCollection/blob/main/Img/01Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6/Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6%E5%A4%A7%E8%87%B4%E5%9B%BE.png?raw=true)

ä¸‹é¢æ˜¯ç®€åŒ–åçš„ä¼ªä»£ç â‘ ï¼Œæ¸²æŸ“å¾ªç¯çš„å¼€å§‹

```js
function startRenderLoop(widget: CesiumWidget) {
  widget._renderLoopRunning = true;

  let lastFrameTime = 0;
  function render(frameTime) { // å•å¸§æ¸²æŸ“å‡½æ•°
    if (widget._useDefaultRenderLoop) {
      try {
          widget.resize(); // å“åº” DOM å˜åŒ–
          widget.render(); // å•å¸§æ¸²æŸ“
          requestAnimationFrame(render); // ä¸‹ä¸€å¸§æ¸²æŸ“
        }
      }
    } else {
      widget._renderLoopRunning = false;
    }
  }

  requestAnimationFrame(render); // å¼€å§‹è§¦å‘æ¸²æŸ“å¾ªç¯
}
```

åŒæ—¶å¯ä»¥çœ‹å‡ºï¼ŒCesiumWidget ç±»ä¹Ÿè´Ÿè´£å“åº” DOM çš„å˜åŒ–ï¼Œä¾‹å¦‚ï¼šçª—å£å°ºå¯¸å˜åŒ–å¯¼è‡´ DIV çš„å˜åŒ–ã€‚



### 2>  Scene ç±»æ˜¯åœºæ™¯å¯¹è±¡å®¹å™¨

éœ€è¦è¿›å…¥åˆ°ä¼ªä»£ç â‘ ä¸­çš„ `widget.render(); // å•å¸§æ¸²æŸ“` 

```js
CesiumWidget.prototype.render = function () {
  if (this._canRender) {
    ...
    this._scene.render(currentTime); // çœ‹è¿™å¥
  } else {...}
};
```

é€šè¿‡ç®€å•æŸ¥çœ‹ Scene  ç±»ä¸­æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼šç›®å‰æ˜ç™½è¿™ä¸ªç±»ä¿å­˜ç€å¤§é‡åœºæ™¯å¯¹è±¡å’ŒçŠ¶æ€ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥å€ŸåŠ©å…¶ä»–ç±»æ¥ç»˜åˆ¶å•å¸§ä¸­å‡ºç°çš„åœ°çƒã€å®ä½“ç­‰æ•°æ®ã€‚

ğŸ¤”æœ‰å¾…å›ç­”ï¼šå“ªäº›åœºæ™¯å’ŒçŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€å…·ä½“çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ



Scene  ç±»åŸå‹ä¸Šçš„ `render` æ–¹æ³•è´Ÿè´£ï¼š

- è§¦å‘å•å¸§ä¸­çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆ`preUpdateã€preRenderã€postUpdateã€postRender`ï¼‰ğŸ”¢ã€‚è¿™ä¸ªåœ°æ–¹æ¶‰åŠ Cesium äº‹ä»¶æœºåˆ¶çŸ¥è¯†ç‚¹ã€‚
- æ›´æ–°å¸§çŠ¶æ€å’Œå¸§åºå·
- æ›´æ–° `Scene` ä¸­çš„ Primitive
- è°ƒç”¨ç±»ä¸­çš„ `render` å‡½æ•°ï¼Œå°†æ¸²æŸ“è´£ä»»é€’ç»™ WebGL context ï¼ˆå…¶å®æ˜¯ Context å¯¹è±¡ï¼Œå¯¹ WebGL çš„å°è£…ï¼‰ï¼Œè§¦å‘ç»˜åˆ¶ã€‚

ä¸‹é¢æ˜¯Scene  ç±»åŸå‹ä¸Šçš„ `render` æ–¹æ³•çš„ä¼ªä»£ç 

```js
/**
 * Update and render the scene. It is usually not necessary to call this function
 * directly because {@link CesiumWidget} or {@link Viewer} do it automatically.
 * @param {JulianDate} [time] The simulation time at which to render.
 */
Scene.prototype.render = function (time) {
  // 1. Pre passes update. Execute any pass invariant code that should run before the passes here.
  this._preUpdate.raiseEvent(this, time); // 1ï¸âƒ£

  const frameState = this._frameState;
  frameState.newFrame = false;

  if (!defined(time)) {time = JulianDate.now();}

  // Determine if shouldRender
  const cameraChanged = this._view.checkForCameraUpdates(this);
  let shouldRender = ...
  if (...) {
    const difference = ...
    shouldRender = shouldRender || difference > this.maximumRenderTimeChange;
  }

  if (shouldRender) {
    ... æ›´æ–°éƒ¨åˆ†çŠ¶æ€

    const frameNumber = CesiumMath.incrementWrap(...);
    updateFrameNumber(this, frameNumber, time);
    frameState.newFrame = true;
  }

  tryAndCatchError(this, prePassesUpdate);

  // 2. Passes update. Add any passes here
  if (this.primitives.show) {
    tryAndCatchError(this, updateMostDetailedRayPicks);
    tryAndCatchError(this, updatePreloadPass);
    tryAndCatchError(this, updatePreloadFlightPass);
    if (!shouldRender) {
      tryAndCatchError(this, updateRequestRenderModeDeferCheckPass);
    }
  }

  this._postUpdate.raiseEvent(this, time); // 2ï¸âƒ£

  if (shouldRender) {
    this._preRender.raiseEvent(this, time); // 3ï¸âƒ£
    frameState.creditDisplay.beginFrame();
    tryAndCatchError(this, render); // âœ¨å°†æ¸²æŸ“è´£ä»»é€’ç»™ WebGL context 
  }

  // 4. Post passes update. Execute any pass invariant code that should run after the passes here.
  updateDebugShowFramesPerSecond(this, shouldRender);
  tryAndCatchError(this, postPassesUpdate);

  callAfterRenderFunctions(this);

  if (shouldRender) {
    this._postRender.raiseEvent(this, time); // 4ï¸âƒ£
    frameState.creditDisplay.endFrame();
  }
};
```

å›¾ç¤ºäº†ç”Ÿå‘½å‘¨æœŸï¼Œâœ’è¯¥å›¾ä¼šä¸æ–­ æ›´æ–°&æ”¹å˜ å†…å®¹ï¼Œæš‚æ—¶è¿™æ ·ã€‚

<img src="https://github.com/githubli1123/CesiumExampleCollection/blob/main/Img/01Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6/LifecycleEvent.png?raw=true" alt="Lifecycle" style="zoom: 80%;" />

ç”±äºç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç±»ä¼¼çš„ä»£ç  `scene.addEventListener(cb)` æ¥ä¸ºæ¯ä¸€å¸§åšä¸€äº›è‡ªå®šä¹‰çš„ä»»åŠ¡ã€‚
ä¾‹å¦‚ï¼šæ¯æ¬¡æ¸²æŸ“ä¹‹å‰ï¼ˆå³preRenderäº‹ä»¶ï¼‰æ‰“å°ä¸€ä¸‹`æ—¶é—´å·®ä¸å¤šå–½` ã€‚ä»£ç å¤§è‡´ï¼š

```js
viewer.scene.preRender.addEventListener(()=>{
	console.log('æ—¶é—´å·®ä¸å¤šå–½');
})
```





### 3>  Event ç±»å®ç°äº‹ä»¶æœºåˆ¶

åœ¨ç¼–ç¨‹é¢†åŸŸï¼Œå½“è°ˆè®ºäº‹ä»¶è¿™ä¸ªæ¦‚å¿µæ—¶ï¼Œä¸€èˆ¬èƒŒé ç€ äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼ˆEvent-Driven Programmingï¼‰æ€æƒ³ ã€‚äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ˜¯ä¸€ç§å¸¸è§çš„ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒåŸºäºäº‹ä»¶å’Œäº‹ä»¶å¤„ç†å™¨çš„æ¦‚å¿µï¼Œé€šè¿‡ç›‘å¬å’Œå“åº”äº‹ä»¶æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚

äº‹ä»¶ï¼š

- ç”¨æˆ·çš„åŠ¨ä½œï¼ˆå¦‚ ç‚¹å‡»é¼ æ ‡ã€æŒ‰ä¸‹é”®ç›˜ç­‰ï¼‰
- ç³»ç»ŸçŠ¶æ€å˜åŒ–ï¼ˆå¦‚ ç½‘ç»œè¯·æ±‚å®Œæˆã€å®šæ—¶å™¨åˆ°æœŸç­‰ï¼‰
- ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆå¦‚ å•å¸§æ¸²æŸ“è¿‡ç¨‹ä¸­æŒ‰æ•°æ®æ›´æ–°ä¸æ¸²æŸ“è¿™ä¸¤ä¸ªé‡è¦è¿‡ç¨‹ç»†åŒ–çš„å››ä¸ªäº‹ä»¶ï¼špreUpdateã€preRenderã€postUpdateã€postRenderğŸ”¢ ï¼‰
- å…¶ä»–å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼ˆå¦‚ Entity å±æ€§çš„æ”¹å˜ã€Entity çš„å¢åŠ ç­‰ï¼‰

äº‹ä»¶å¤„ç†å™¨ï¼šä¸ºè¯¥äº‹ä»¶æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œäº‹ä»¶è§¦å‘åç”±å…¶å¤„ç†ã€‚



ç«™åœ¨äº‹ä»¶æœºåˆ¶çš„è§’åº¦ï¼Œå¯¹è¿™ä¸ª Scene åŸå‹ä¸Šçš„ `render()` æ–¹æ³•è¿›è¡Œåˆ†æï¼šç•¥......è§ä¸‹å›¾

<img src="https://github.com/githubli1123/CesiumExampleCollection/blob/main/Img/01Cesium%E7%9A%84%E6%B8%B2%E6%9F%93%E8%B0%83%E5%BA%A6/event.png?raw=true" alt="event"  />

å·¦ä¸Šè§’ä¸ºäº‹ä»¶æ³¨å†Œè€…ï¼Œæä¾›äº‹ä»¶å›è°ƒã€‚å³è¾¹ä¸ºäº‹ä»¶å¤„ç†è€…æˆ–è€…å«äº‹ä»¶è§¦å‘å™¨ï¼Œç”±ä¸€ä¸ªäº‹ä»¶æ¥è§¦å‘ äº‹ä»¶å¤„ç†è€…ã€‚ç”±äºè¯¥ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç±»ä¼¼çš„ä»£ç  `scene.addEventListener(cb)` æ¥ä¸ºæ¯ä¸€å¸§åšä¸€äº›è‡ªå®šä¹‰çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼šæ¯æ¬¡æ¸²æŸ“ä¹‹å‰ï¼ˆå³preRenderäº‹ä»¶ï¼‰æ‰“å°ä¸€ä¸‹`æ—¶é—´å·®ä¸å¤šå–½` ã€‚

è¿™ä¸ª Event ç±»ä¼šåœ¨åé¢åå¤ä½¿ç”¨ï¼Œå¤ç”¨ä¹Ÿæ˜¯ Cesium è§£è€¦å‡ºè¿™ä¸ª helper class çš„åŸå› ã€‚åŒæ—¶ï¼Œè§£è€¦ Event ç±»å¯ä»¥è®©äº‹ä»¶æœºåˆ¶æ›´åŠ æ¸…æ™°ç‹¬ç«‹ã€‚
Cesium å®ç°äº‹ä»¶æœºåˆ¶çš„æ¨¡å¼æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublisher-Subscriberï¼‰ï¼Œå…·æœ‰ä¸€ä¸ªäº‹ä»¶ä¸­å¿ƒï¼ˆEventEmitterï¼‰ä¹Ÿå°±æ˜¯å®ä¾‹åŒ–çš„ Event ï¼špreUpdateã€postUpdate ç­‰ã€‚

äº‹ä»¶æœºåˆ¶ä¹Ÿå¯ä»¥ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰æ¥å®ç°ï¼Œè¿™äº›æ¨¡å¼å†³å®šäº†äº‹ä»¶å¦‚ä½•åœ¨ç»„ä»¶ä¹‹é—´è¿›è¡Œä¼ é€’å’Œå¤„ç†ã€‚



### 4>  å°ç»“

Cesium çš„æ¸²æŸ“å¾ªç¯ï¼Œæ˜¯åœ¨å®ä¾‹åŒ– `Viewer` æ—¶å®ä¾‹åŒ–äº† `CesiumWidget` ï¼Œç”±å±æ€§ `_useDefaultRenderLoop` setter è§¦å‘ `startRenderLoop()` æ–¹æ³•ï¼Œä»è€Œå¼€å¯äº†æ¸²æŸ“å¾ªç¯ã€‚åœ¨ç»˜åˆ¶ä¸€å¸§çš„é€»è¾‘ä¸­ï¼š

âœ… `CesiumWidget ç±»` æ”¯æŒäº†å¯¹ DOM å˜åŒ–çš„å“åº”ï¼Œè®© å¸§æ¸²æŸ“å‡ºçš„å†…å®¹ æ”¾ç½®åœ¨åˆé€‚æ­£ç¡®çš„å¸ƒå±€ä¸­ã€‚

âœ… `CesiumWidget ç±»` å°†æ¸²æŸ“è´£ä»»é€’ç»™ WebGL context ï¼Œè´£ä»»åˆ’åˆ†æ˜ç¡®ï¼Œåªæ‹…ä»»æ¸²æŸ“è°ƒåº¦è€…ï¼Œæ¸²æŸ“çš„å…·ä½“é€»è¾‘ï¼ˆæŒ‡ç»˜åˆ¶åœ°çƒç­‰ï¼‰ä¸åŒ…å«å…¶ä¸­ã€‚

âœ… `Scene ç±»` æ”¯æŒäº†å¸§æ¸²æŸ“ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œä¸ºå¼€å‘è€…é¢„ç•™äº†å¯¹ å¸§æ¸²æŸ“è¿‡ç¨‹ çš„æ“ä½œç©ºé—´ã€‚

ğŸŒŸğŸ¤” `CesiumWidget ç±»` è¿˜æœ‰å…¶ä»–å€¼å¾—æŒ–æ˜çš„ç‚¹ï¼Œå€¼å¾—æŒ–æ˜çš„æ˜¯å®ƒæ‰€ç®¡ç†çš„å…¶ä»–ç±»ï¼Œé˜…è¯»åé¢çš„æºç å†åšæ€»ç»“ã€‚

ç›®å‰æ²¡æœ‰å¿…è¦å†ç»§ç»­æ·±ç©¶ åœ°çƒæ˜¯å¦‚ä½•ç»˜åˆ¶çš„ å®ä½“æ˜¯å¦‚ä½•ç»˜åˆ¶çš„ï¼Œè¿™æ¶‰åŠ Globe ã€Primitive ç­‰æ•°æ®å®ä½“çš„æ›´æ–°å’Œæ¸²æŸ“ï¼Œä¹Ÿæ¶‰åŠåˆ° WebGL åœ¨ Cesium ä¸­å¦‚ä½•è°ƒåº¦ â€”â€” è¿™äº›éƒ½ä¸æ˜¯æ¸²æŸ“å¾ªç¯è¿™ä¸ªæ¦‚å¿µä¸­çš„å†…å®¹ã€‚

### 5>  å‚è€ƒèµ„æ–™

[CesiumåŸç†ç¯‡ï¼š1æœ€é•¿çš„ä¸€å¸§ä¹‹æ¸²æŸ“è°ƒåº¦ - fu*k ](https://www.cnblogs.com/fuckgiser/p/5744509.html)

[CesiumJS 2022^ æºç è§£è¯» ä½¿ç”¨ requestAnimationFrame å¾ªç¯è§¦å‘å¸§åŠ¨ç”»](https://zhuanlan.zhihu.com/p/493708959)

[cesium åœºæ™¯Scene - ç®€ä¹¦ (jianshu.com)](https://www.jianshu.com/p/b48e4a9436b7)

[ã€cesiumçŸ¥è¯†æ¢³ç†ã€‘3.å„ç±»äº‹ä»¶ ](https://juejin.cn/post/7264779043211821096)

[Cesiumå¿«é€Ÿä¸Šæ‰‹1-CesiumWidget-Sceneç»“æ„](https://blog.csdn.net/sky___Show/article/details/132089197)
